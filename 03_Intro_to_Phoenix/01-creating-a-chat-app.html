<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="R6ba5MLXyH1nPWUW2FaRbcaaqid5fFEUiymqWpcGEFc" />

  <title>Creating a Chat App</title>
  <meta name="description" content="We empower people with technology through teaching and facilitating access, enlarging the community of people who give back and teach others.
">
  
  <meta name="author" content="ElixirBridge">
  <meta name="copyright" content="&copy; ElixirBridge 2019">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/monokai_sublime.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/elixir-bridge.github.io/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/elixir-bridge.github.io/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/elixir-bridge.github.io/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/elixir-bridge.github.io/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/elixir-bridge.github.io/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/elixir-bridge.github.io/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/elixir-bridge.github.io/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/elixir-bridge.github.io/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/elixir-bridge.github.io/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/elixir-bridge.github.io/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/elixir-bridge.github.io/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/elixir-bridge.github.io/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/elixir-bridge.github.io/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/elixir-bridge.github.io/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/elixir-bridge.github.io/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/elixir-bridge.github.io/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/elixir-bridge.github.io/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
  <meta property="og:description" content="We empower people with technology through teaching and facilitating access, enlarging the community of people who give back and teach others.
" />
  <meta property="og:url" content="" />
  <meta property="og:site_name" content="ElixirBridge for Girls" />
  <meta property="og:title" content="Creating a Chat App" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/elixir-bridge.github.io/assets/logo.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" />
  

  
  <!-- Twitter: card tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Creating a Chat App">
  <meta name="twitter:description" content="We empower people with technology through teaching and facilitating access, enlarging the community of people who give back and teach others.
">
  <meta name="twitter:image" content="/elixir-bridge.github.io/assets/logo.png">
  <meta name="twitter:url" content="">
  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/elixir-bridge.github.io/css/main.css">
  <link rel="canonical" href="/elixir-bridge.github.io/03_Intro_to_Phoenix/01-creating-a-chat-app.html">
  <link rel="alternate" type="application/rss+xml" title="ElixirBridge for Girls" href="/elixir-bridge.github.io/feed.xml" />
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/elixir-bridge.github.io/" class="logo">
      
      <img src="/elixir-bridge.github.io/assets/logo.png" alt="ElixirBridge for Girls">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
  </div>
</header>


    <div class="page-wrapper">
      <div class="sidebar">
  <!-- get the sections -->




<!-- make them an array -->



<h4>
  
    <a href="/docs">Docs</a>
  
</h4>


<!-- spit them out as a list of lists -->

  

  
    <h4>Installfest</h4>
    <ul class="sidebar-list">
    
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/01_Installfest/01-begin-installfest.html'>Installfest</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/01_Installfest/02-choose-your-own-operating-system.html'>Choose your own operating system</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/01_Installfest/03-macintosh-osx-setup.html'>Mac OSX setup</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/01_Installfest/03-windows-setup.html'>Windows setup</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/01_Installfest/04-install-and-configure-git.html'>Install and Configure git</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/01_Installfest/05-install-elixir-and-phoenix.html'>Install Elixir and Phoenix</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/01_Installfest/06-create-an-ssh-key.html'>Create an SSH Key</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/01_Installfest/07-create-a-heroku-account.html'>Create a Heroku Account</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/01_Installfest/08-create-phoenix-app.html'>Create a Phoenix App</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/01_Installfest/09-generate-a-database-model.html'>Generate a Database Model</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/01_Installfest/10-deploy-a-phoenix-app.html'>Deploy a Phoenix App</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/01_Installfest/11-deploy-to-heroku.html'>Deploy to Heroku</a></li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    </ul>
  

  
    <h4>Intro to Elixir</h4>
    <ul class="sidebar-list">
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/01-why-program-why-elixir.html'>Why program? Why elixir?</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/03-learning-elixir.html'>Learning Elixir</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/04-elixir-types.html'>Elixir Types</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/05-operators-and-variables.html'>Operators and Variables</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/05.5-anonymous-functions-lists-and-tuples.html'>Lists and Tuples</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/05.6-keyword-lists.html'>Keyword Lists</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/05.7-maps-and-nested-data-structures.html'>Maps and Nested Data Structures</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/05.9-enumerables.html'>Enumerables</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/06-pattern-matching.html'>Pattern Matching</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/06.4-modules.html'>Modules</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/06.5_Functions.html'>Functions</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/08-keyword-lists.html'>Keyword Lists</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/09-maps-and-nested-data-structures.html'>Maps and Nested Data Structures</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/02_Intro_to_Elixir/12-recursion.html'>Recursion</a></li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    </ul>
  

  
    <h4>Intro to Phoenix</h4>
    <ul class="sidebar-list">
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/03_Intro_to_Phoenix/01-creating-a-chat-app.html'>Creating a Chat App</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/03_Intro_to_Phoenix/02-add-a-perisistence-layer.html'>Adding a Persistence layer</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/03_Intro_to_Phoenix/13-create-a-phoenix-app.html'>Create a Phoenix App</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/03_Intro_to_Phoenix/14-running-the-application-locally.html'>Running the Application Locally</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/03_Intro_to_Phoenix/15-creating-a-migration.html'>Creating a Migration</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/03_Intro_to_Phoenix/16-phoenix-architecture.html'>Phoenix architecture</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/03_Intro_to_Phoenix/17-CRUD-with-scaffolding.html'>CRUD with scaffolding</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/03_Intro_to_Phoenix/18-setting-the-default-page.html'>Setting the Default Page</a></li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    </ul>
  

  
    <h4>Mix Applications</h4>
    <ul class="sidebar-list">
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/01-mix.html'>Mix</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/02-adding-dependencies.html'>Adding dependencies</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/03-testing.html'>Testing</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/04-set-up-my-app.html'>Our first application</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/05-interacting-with-iex.html'>Interacting with iex</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/06-environments.html'>Environments</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/07-documentation.html'>Documentation</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/12-supervisors.html'>Supervisors</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/13-router.html'>Router</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/14-plugs.html'>Plugs</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/15-plug-router.html'>Plug.Router</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/16-templating.html'>Templating</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/16.5-genserver.html'>GenServer</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/17-deployment.html'>Deployment</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/18-dockerfile.html'>Docker and the Dockerfile</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/19-distillery-config.html'>Distillery</a></li>
      
    
      
        <li class="sidebar-list-item"><a href='/elixir-bridge.github.io/04_Mix_Applications/20-running-docker.html'>Running docker</a></li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    </ul>
  


</div>

      <div class="page-content">
          <div class="wrapper">
<div class="page">

  <header class="post-header">
    <h1 class="post-title">Creating a Chat App</h1>
  </header>

  <article class="post-content">
    <h4 id="building-a-simple-chat-app-with-elixir-and-phoenix">Building a Simple Chat App With Elixir and Phoenix</h4>

<p>In this curriculum with will build a simple chat app that takes advantage of phoenix’s easy uses of web sockets and evented programming</p>

<h3 id="goals">Goals:</h3>

<p>Through this app we will:</p>

<ul>
  <li>gain a better understanding of web sockets</li>
  <li>learn how to take advantage of Elixir’s Asychronous programming model</li>
</ul>

<p>Getting Started</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Create a new Phoenix project called chatter
$ mix phx.new chatter
</code></pre></div></div>

<h1 id="prepare-the-app-for-the-first-start">Prepare the app for the first start</h1>

<p>There are a few more steps to get our app ready for the first start. First, we need to get into or project directory. Then, we need to create the database that we’ll use later. For now, it’s enough that it exists.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>chatter
mix ecto.create
</code></pre></div></div>

<p>Once you’ve copied these commands, you should see output like the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>02:08:16 matt@pelican
 ~/p/e/chatter&gt;  mix ecto.create
The database <span class="k">for </span>Chatter.Repo has been created
</code></pre></div></div>

<h1 id="start-the-server">Start the server</h1>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mix phx.server
</code></pre></div></div>

<p>Point your browser to localhost:4000, it should look like this:</p>

<p><img src="/assets/new-phx-server.png" alt="New server on first start" /></p>

<h2 id="setting-up-a-new-channel">Setting up a new Channel</h2>

<h3 id="what-is-a-channel">What is a channel</h3>

<p>A channel is persisted connection between the browser and the server. A regular request is like sending letters back and forth between the browser and the server. But a socket is more like a pipe or a phone call. Where the connection is always on, and each side can communicate messages efficiently and quickly. In our case, the server can broadcast messages down and the users can send messages up through their browser.</p>

<ul>
  <li>Down means towards the Clients</li>
  <li>Up means towards the server</li>
</ul>

<p>In a normal request the server only sends one response. But in the case of web sockets the server can continue to send updates as long as the browser maintains the connections.</p>

<p>So channels use websockets.</p>

<h2 id="creating-the-channel-file">Creating the channel file</h2>

<p>Since Phoenix 1.3, there’s a built-in mix task for channels that will create files and do some of the boilerplate work for you. The command is <code class="highlighter-rouge">mix phx.gen.channel &lt;channel name&gt;</code>. Try it out:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/p/e/chatter&gt;  mix phx.gen.channel chat_room
<span class="k">*</span> creating lib/chatter_web/channels/chat_room_channel.ex
<span class="k">*</span> creating <span class="nb">test</span>/chatter_web/channels/chat_room_channel_test.exs

Add the channel to your <span class="sb">`</span>lib/chatter_web/channels/user_socket.ex<span class="sb">`</span> handler, <span class="k">for </span>example:

    channel <span class="s2">"chat_room:lobby"</span>, ChatterWeb.ChatRoomChannel

~/p/e/chatter&gt;
</code></pre></div></div>

<p>At the end of the command, it tells you to add a line to your <code class="highlighter-rouge">lib/chatter_web/channels/user_socket.ex</code> file. You need to do this so the websocket request can be directed to your channel.</p>

<p><code class="highlighter-rouge">chat_room_channel.ex</code> is analogous to a controller in Phoenix, except it is for handling websocket requests instead of http requests.</p>

<p>Looking at the code below,</p>

<p><code class="highlighter-rouge">channel "chat_room:lobby", ChatterWeb.ChatRoomChannel</code></p>

<p><code class="highlighter-rouge">channel</code> above refers to the channel function in phoenix. It takes a topic (which is just a namespace for websocket connections). In our case the name space is “chat_room:lobby”.</p>

<p>The next argument <code class="highlighter-rouge">ChatterWeb.ChatRoomChannel</code> is made up of two parts. The first part <code class="highlighter-rouge">ChatterWeb</code> is the name of the app. The second part <code class="highlighter-rouge">ChatRoomChannel</code> is the name of the module that handles the “chat_room:lobby” channel. In Phoenix, it’s conventional to namespace all your modules with your app name first. This helps avoid collisions.</p>

<p>The file we’re in, <code class="highlighter-rouge">user_channels.ex</code>, is like the <code class="highlighter-rouge">router.ex</code> file, but for channels. The topic, in our case <code class="highlighter-rouge">chat_room:lobby</code> allows clients to subscribe to the channel. In the same way a path in a web request directs the request the right controller, the topic directs the socket to the right module, in this case, <code class="highlighter-rouge">ChatterWeb.ChatRoomChannel</code>.</p>

<p>In our <code class="highlighter-rouge">lib/chatter_web/channels/chat_room_channel.ex</code> paste the following</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">ChatterWeb</span><span class="o">.</span><span class="no">ChatRoomChannel</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ChatterWeb</span><span class="p">,</span> <span class="ss">:channel</span>

  <span class="k">def</span> <span class="n">join</span><span class="p">(</span><span class="sd">"</span><span class="s2">chat_room:lobby"</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">if</span> <span class="n">authorized?</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span> <span class="k">do</span>
      <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
    <span class="k">else</span>
      <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="p">%{</span><span class="ss">reason:</span> <span class="sd">"</span><span class="s2">unauthorized"</span><span class="p">}}</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># Channels can be used in a request/response fashion</span>
  <span class="c1"># by sending replies to requests from the client</span>
  <span class="k">def</span> <span class="n">handle_in</span><span class="p">(</span><span class="sd">"</span><span class="s2">ping"</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:reply</span><span class="p">,</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">payload</span><span class="p">},</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="c1"># It is also common to receive messages from the client and</span>
  <span class="c1"># broadcast to everyone in the current topic (chat_room:lobby).</span>
  <span class="k">def</span> <span class="n">handle_in</span><span class="p">(</span><span class="sd">"</span><span class="s2">new_message"</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">broadcast</span> <span class="n">socket</span><span class="p">,</span> <span class="sd">"</span><span class="s2">new_message"</span><span class="p">,</span> <span class="n">payload</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="c1"># Add authorization logic here as required.</span>
  <span class="k">defp</span> <span class="n">authorized?</span><span class="p">(</span><span class="n">_payload</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We now have a bunch of boilerplate code that doesn’t look like much, but it will work without modification to hook up to a front end for our simple chat app. Let’s look a little closer at what the functions are doing.</p>

<p>First, let’s look at the <code class="highlighter-rouge">join/3</code> function. <code class="highlighter-rouge">def join("chat_room:lobby", payload, socket) do</code>: it takes three arguments. The name of the channel, <code class="highlighter-rouge">"chat_room:lobby"</code>, is so that this function is only called when the client is joining that specific channel. The second argument, <code class="highlighter-rouge">payload</code> is the request from the user; it can contain auth credentials, a message, anything the user wants.</p>

<p>Finally, it takes <code class="highlighter-rouge">socket</code>, which is the websocket connection. There’s a test, <code class="highlighter-rouge">authorized?</code>, which always returns true. Then, <code class="highlighter-rouge">{:ok, socket}</code> just returns a status and the websocket they are connecting to. <code class="highlighter-rouge">join/3</code> always returns <code class="highlighter-rouge">{:ok, socket}</code> to allow all connections to the channel.</p>

<p>Once a user joins to a channel, then they can send messages to the channel and they’ll be received by one of the <code class="highlighter-rouge">handle_in/3</code> messages. The first one just returns the payload sent by the user back to them.</p>

<p>The second one sends the payload to all the users subscribed to the channel. It’s this one that allows us to build out chat room with a little front end work. When we send a message to the chatroom, this function sends it back to you and to everyone else in the channel.</p>

<h2 id="handling-the-connections-on-client-side">Handling the connections on Client-side</h2>

<p>To make things easier, we’ll start by adding jQuery to our <code class="highlighter-rouge">lib/chatter_web/templates/layout/app.html.eex:</code></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"&lt;%= Routes.static_path(@conn, "</span><span class="err">/</span><span class="na">js</span><span class="err">/</span><span class="na">app</span><span class="err">.</span><span class="na">js</span><span class="err">")</span> <span class="err">%</span><span class="nt">&gt;</span><span class="s2">"&gt;</span><span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>Phoenix comes packed with a simple javascript socket client, but it’s disabled by default. Go into your <code class="highlighter-rouge">assets/js/app.js</code> and uncomment the last line:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import socket from "./socket"
</code></pre></div></div>

<p>Go into your <code class="highlighter-rouge">assets/js/socket.js</code> and replace the generated code after the comment <code class="highlighter-rouge">Now that you are connected, you can join channels with a topic</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let channel = socket.channel('chat_room:lobby', {});
let list = $('#message-list');
let message = $('#message');
let name = $('#name');

message.on('keypress', event =&gt; {
  if (event.keyCode == 13) {
    channel.push('new_message', {name: name.val(), message: message.val()});
    message.val('');
  }
});

channel.on('new_message', payload =&gt; {
  list.append(`&lt;b&gt;${payload.name || 'Anonymous'}:&lt;/b&gt; ${payload.message}&lt;br&gt;`);
  list.prop({scrollTop: list.prop('scrollHeight')});
});

channel
  .join()
  .receive('ok', resp =&gt; {
    console.log('Joined successfully', resp);
  })
  .receive('error', resp =&gt; {
    console.log('Unable to join', resp);
  });

export default socket;
</code></pre></div></div>

<p><code class="highlighter-rouge">socket.channel("chat_room:lobby", {})</code> sends the join request to the server, and the server sends the message back to the client.</p>

<p>Here, we listen for a keypress event on the message text field. Whenever the user enters a message, it’s pushed on the channel and the text field is cleared. When there’s an incoming message on the channel, it’s appended to the div we previously created and scrolled to the bottom.</p>

<h2 id="creating-the-view">Creating the View</h2>

<p>Now we have to write the markup and CSS for our chat app. Open <code class="highlighter-rouge">lib/chatter_web/templates/page/index.html.eex</code>, and replace its contents with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div id='message-list' class='row'&gt;
&lt;/div&gt;

&lt;div class='row form-group'&gt;
  &lt;div class='col-md-3'&gt;
    &lt;input type='text' id='name' class='form-control' placeholder='Name' /&gt;
  &lt;/div&gt;
  &lt;div class='col-md-9'&gt;
    &lt;input type='text' id='message' class='form-control' placeholder='Message' /&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre></div></div>

<p>We’ve created an empty div that will list all chat messages and two text fields (one for the user’s name and one for the message).</p>

<p>Now open <code class="highlighter-rouge">assets/css/app.css </code>and paste this at the end:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">#message-list</span> <span class="p">{</span>
  <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#777</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">400px</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="nl">overflow</span><span class="p">:</span> <span class="nb">scroll</span><span class="p">;</span>
  <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">50px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

  </article>
  
  
  
  
    <h4>Next step: </h4>
    <p>Go on to <a href="/03_Intro_to_Phoenix/02-add-a-perisistence-layer.html">Adding a Persistence layer</a>.</p>
  
  
    <h4>Or:</h4>
    <p>Go back to <a href="/02_Intro_to_Elixir/12-recursion.html">Recursion</a>.</p>
  



</div>
</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">ElixirBridge for Girls</h3>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:info@elixirbridge.org">
            <i class="fa fa-envelope-o"></i>
            <span class="username">info@elixirbridge.org</span>
          </a>
        </li>

        
          
          <li>
            <a href="https://twitter.com/elixirbridge" title="Twitter">
              <i class="fa fa-twitter"></i>
              <span class="username">elixirbridge</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://github.com/elixir-bridge" title="GitHub">
              <i class="fa fa-github"></i>
              <span class="username">elixirbridge</span>
            </a>
          </li>
          
        

      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/elixir-bridge.github.io/feed.xml">via RSS</a></strong></p>
      <p class="text">We empower people with technology through teaching and facilitating access, enlarging the community of people who give back and teach others.
</p>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js"></script>
<script>

$(document).ready(function() {

  // Syntax highlighting
  hljs.initHighlightingOnLoad();

  const hamburgerMenu = document.getElementById("js-mobile-menu")
  const sidebar = document.getElementsByClassName("sidebar")[0]

  hamburgerMenu.addEventListener("click", () => {
    sidebar.classList.toggle("mobile-show")
  })
});

</script>




  </body>

</html>
